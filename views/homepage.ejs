<!DOCTYPE html>
<html>
<head>
  <title><%= title %></title>
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <div class="page-wrapper">
    <div class="container">
      
      <div class="topbar">
        <p>Welcome, <%= user ? user.userName : "Guest" %></p>
        <a href="/logout">Logout</a>
      </div>

      <form method="POST" action="/notes" class="note-form">
        <textarea name="noteContent" placeholder="Write a note..." required></textarea>
        <button type="submit">Add note</button>
      </form>

      <% if (notes && notes.length) { %>
        <ul class="notes">
          <% notes.forEach(function(note) { %>
            <li>
              <form method="POST" action="/notes/edit/<%= note._id %>">
                <textarea name="noteContent"><%= note.noteContent %></textarea>
                <div class="note-footer">
                  <div class="timestamp">
                    <small>
                      Last modified:
                      <%= note.noteLastModified 
                           ? new Date(note.noteLastModified).toLocaleString("en-HK", { timeZone: "Asia/Hong_Kong" }) 
                           : "N/A" %>
                    </small>
                  </div>
                  <div class="actions">
                    <button type="submit">Save</button>
                    <a href="/notes/delete/<%= note._id %>">Delete</a>
                  </div>
                </div>
              </form>
            </li>
          <% }) %>
        </ul>
      <% } else { %>
        <p>No notes yet.</p>
      <% } %>

    </div>
  </div>
</body>
</html>
